{

// testedfiles: SleposImageBuilder.ycp

include "testsuite.ycp";
TESTSUITE_INIT([], nil);

import "SleposImageBuilder";

integer testNum = 0;

map READ = $[];
map WRITE = $[];
map EXECUTE = $[];


// nonzero return code of SCR::Execute(.target.bash_output).
testNum = testNum + 1;
DUMP("*******************************************************");
DUMP(sformat("TEST CASE #%1", testNum));

READ = $[];
WRITE = $[];
EXECUTE = $[
	"target" : $[
		"bash_output" : $["exit":1, "stdout":"", "stderr":""]
	]
];

TEST(``(SleposImageBuilder::Read()), [READ, WRITE, EXECUTE], nil);
DUMP(sformat("ImagesMap=%1", SleposImageBuilder::ImagesMap));


// nothing returned by SCR::Execute(.target.bash_output).
testNum = testNum + 1;
DUMP("*******************************************************");
DUMP(sformat("TEST CASE #%1", testNum));

EXECUTE = $[
	"target" : $[
		"bash_output" : $["exit":0, "stdout":"", "stderr":""]
	]
];

TEST(``(SleposImageBuilder::Read()), [READ, WRITE, EXECUTE], nil);
DUMP(sformat("ImagesMap=%1", SleposImageBuilder::ImagesMap));


// stdout returned by SCR::Execute(.target.bash_output).
testNum = testNum + 1;
DUMP("*******************************************************");
DUMP(sformat("TEST CASE #%1", testNum));

READ = $[
	"slepos_xml" : $[
		"//ImageSpecification/@ImageName"	: $["//ImageSpecification/@ImageName"		: "browser"],
		"//ImageSpecification/@ImageVersion"	: $["//ImageSpecification/@ImageVersion"	: "2.0.21"],
		"//ImageSpecification/@Type"		: $["//ImageSpecification/@Type"		: ""],
		"//ImageSpecification/@ImageType"	: $["//ImageSpecification/@ImageType"		: ""],
		"//ImageSpecification/@Timezone"	: $["//ImageSpecification/@Timezone"		: ""],
		"//ImageSpecification/@Locale"		: $["//ImageSpecification/@Locale"		: ""],
		"//ImageSpecification/@Keytable"	: $["//ImageSpecification/@Keytable"		: ""],
		"//IncludeSpecificationList/IncludeSpecification/@URI"	: $["//IncludeSpecificationList/IncludeSpecification/@URI"	: ""],
		"//RPMSpecifications/DistributionSource/@ImageClass"	: $["//RPMSpecifications/DistributionSource/@ImageClass"	: "NLD"],
		"//UserGroupSpecifications/RootSettings/@DisableRootAccess"	: $["//UserGroupSpecifications/RootSettings/@DisableRootAccess"	: ""],
	]
];

EXECUTE = $[
	"target" : $[
		"bash_output" : $["exit":0, "stdout":"2006-Feb-07 01:02:07 <1> : Image: browser-2.0.21       Version: 2.0.21
2006-Feb-07 01:02:07 <1> : Image: cdboot-2.0.21        Version: 2.0.21
2006-Feb-07 01:02:07 <1> : Image: desktop-2.0.21       Version: 2.0.21
2006-Feb-07 01:02:07 <1> : Image: disknetboot-2.0.21   Version: 2.0.21
2006-Feb-07 01:02:07 <1> : Image: ibmJava-1.0.0        Version: 1.0.0
2006-Feb-07 01:02:07 <1> : Image: java-2.0.21          Version: 2.0.21
2006-Feb-07 01:02:07 <1> : Image: minimal-2.0.21       Version: 2.0.21", "stderr":""]
	]
];

TEST(``(SleposImageBuilder::Read()), [READ, WRITE, EXECUTE], nil);
DUMP(sformat("ImagesMap=%1", SleposImageBuilder::ImagesMap));



}
